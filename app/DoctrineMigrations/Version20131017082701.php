<?php

namespace Application\Migrations;

use Doctrine\DBAL\Migrations\AbstractMigration,
    Doctrine\DBAL\Schema\Schema;

/**
 * Auto-generated Migration: Please modify to your need!
 */
class Version20131017082701 extends AbstractMigration
{
    public function up(Schema $schema)
    {
        // this up() migration is autogenerated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() != "mysql");
        
        $this->addSql("ALTER TABLE comment DROP FOREIGN KEY FK_9474526CE2904019");
        $this->addSql("CREATE TABLE country_state (id INT AUTO_INCREMENT NOT NULL, country_id INT DEFAULT NULL, name VARCHAR(255) NOT NULL, INDEX IDX_473C711F92F3E70 (country_id), PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE suspended_ip_address (id INT AUTO_INCREMENT NOT NULL, ip_address VARCHAR(50) NOT NULL, suspended_until DATETIME DEFAULT NULL, INDEX ip_date_idx (ip_address, suspended_until), PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE code_assignment_code (id INT AUTO_INCREMENT NOT NULL, user INT DEFAULT NULL, assignment INT DEFAULT NULL, code VARCHAR(255) NOT NULL, email_sent_at DATETIME DEFAULT NULL, INDEX IDX_7130DFC18D93D649 (user), INDEX IDX_7130DFC130C544BA (assignment), PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE code_assignment (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(255) NOT NULL, url VARCHAR(255) NOT NULL, type VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE pd_group_email (id INT AUTO_INCREMENT NOT NULL, group_id INT DEFAULT NULL, sender_id INT DEFAULT NULL, site_id INT DEFAULT NULL, subject VARCHAR(255) NOT NULL, message LONGTEXT DEFAULT NULL, created_at DATETIME NOT NULL, sent_at DATETIME DEFAULT NULL, sent_to_all TINYINT(1) NOT NULL, INDEX IDX_674859C8FE54D947 (group_id), INDEX IDX_674859C8F624B39D (sender_id), INDEX IDX_674859C8F6BD1646 (site_id), PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE pd_group_email_recipient (groupmassemail_id INT NOT NULL, user_id INT NOT NULL, INDEX IDX_2468481F3E379065 (groupmassemail_id), INDEX IDX_2468481FA76ED395 (user_id), PRIMARY KEY(groupmassemail_id, user_id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE promo_code_contest_consolation_code (id INT AUTO_INCREMENT NOT NULL, contest_id INT DEFAULT NULL, user INT DEFAULT NULL, country_id INT DEFAULT NULL, value VARCHAR(255) NOT NULL, assigned_at DATETIME DEFAULT NULL, assigned_site VARCHAR(10) DEFAULT NULL, ip_address VARCHAR(100) DEFAULT NULL, INDEX IDX_82E0B4401CD0F0DE (contest_id), INDEX IDX_82E0B4408D93D649 (user), INDEX IDX_82E0B440F92F3E70 (country_id), PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE promo_code_contest_winning_code (id INT AUTO_INCREMENT NOT NULL, contest_id INT DEFAULT NULL, user INT DEFAULT NULL, country_id INT DEFAULT NULL, value VARCHAR(255) NOT NULL, assigned_at DATETIME DEFAULT NULL, assigned_site VARCHAR(10) DEFAULT NULL, ip_address VARCHAR(100) DEFAULT NULL, INDEX IDX_C36AC5091CD0F0DE (contest_id), INDEX IDX_C36AC5098D93D649 (user), INDEX IDX_C36AC509F92F3E70 (country_id), PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE groupevent_media (groupevent_id INT NOT NULL, media_id INT NOT NULL, INDEX IDX_9FB181EA83BF5DFA (groupevent_id), INDEX IDX_9FB181EAEA9FDD75 (media_id), PRIMARY KEY(groupevent_id, media_id)) ENGINE = InnoDB");
        $this->addSql("ALTER TABLE country_state ADD CONSTRAINT FK_473C711F92F3E70 FOREIGN KEY (country_id) REFERENCES country(id)");
        $this->addSql("ALTER TABLE code_assignment_code ADD CONSTRAINT FK_7130DFC18D93D649 FOREIGN KEY (user) REFERENCES fos_user(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE code_assignment_code ADD CONSTRAINT FK_7130DFC130C544BA FOREIGN KEY (assignment) REFERENCES code_assignment(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE pd_group_email ADD CONSTRAINT FK_674859C8FE54D947 FOREIGN KEY (group_id) REFERENCES pd_groups(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_group_email ADD CONSTRAINT FK_674859C8F624B39D FOREIGN KEY (sender_id) REFERENCES fos_user(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_group_email ADD CONSTRAINT FK_674859C8F6BD1646 FOREIGN KEY (site_id) REFERENCES pd_site(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_group_email_recipient ADD CONSTRAINT FK_2468481F3E379065 FOREIGN KEY (groupmassemail_id) REFERENCES pd_group_email(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE pd_group_email_recipient ADD CONSTRAINT FK_2468481FA76ED395 FOREIGN KEY (user_id) REFERENCES fos_user(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE promo_code_contest_consolation_code ADD CONSTRAINT FK_82E0B4401CD0F0DE FOREIGN KEY (contest_id) REFERENCES pd_sweepstakes(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE promo_code_contest_consolation_code ADD CONSTRAINT FK_82E0B4408D93D649 FOREIGN KEY (user) REFERENCES fos_user(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE promo_code_contest_consolation_code ADD CONSTRAINT FK_82E0B440F92F3E70 FOREIGN KEY (country_id) REFERENCES country(id)");
        $this->addSql("ALTER TABLE promo_code_contest_winning_code ADD CONSTRAINT FK_C36AC5091CD0F0DE FOREIGN KEY (contest_id) REFERENCES pd_sweepstakes(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE promo_code_contest_winning_code ADD CONSTRAINT FK_C36AC5098D93D649 FOREIGN KEY (user) REFERENCES fos_user(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE promo_code_contest_winning_code ADD CONSTRAINT FK_C36AC509F92F3E70 FOREIGN KEY (country_id) REFERENCES country(id)");
        $this->addSql("ALTER TABLE groupevent_media ADD CONSTRAINT FK_9FB181EA83BF5DFA FOREIGN KEY (groupevent_id) REFERENCES group_event(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE groupevent_media ADD CONSTRAINT FK_9FB181EAEA9FDD75 FOREIGN KEY (media_id) REFERENCES pd_media(id) ON DELETE CASCADE");
        $this->addSql("DROP TABLE Thread");
        $this->addSql("DROP TABLE comment");
        $this->addSql("DROP TABLE group_events_attendees_gallary");
        $this->addSql("ALTER TABLE pd_sent_emails ADD errorMessage VARCHAR(255) DEFAULT NULL");
        $this->addSql("ALTER TABLE pd_contest ADD hidden TINYINT(1) NOT NULL");
        $this->addSql("CREATE INDEX votetype_idx ON commenting_vote (vote_type)");
        $this->addSql("ALTER TABLE fos_user ADD organization VARCHAR(255) DEFAULT NULL, ADD title VARCHAR(255) DEFAULT NULL, ADD industry VARCHAR(255) DEFAULT NULL, ADD eventRole VARCHAR(255) DEFAULT NULL, DROP school, DROP major, DROP svicRole");
        $this->addSql("CREATE UNIQUE INDEX user_giveaway ON pd_key_request_state (user_id, giveaway_id)");
        $this->addSql("CREATE UNIQUE INDEX user_deal ON pd_key_request_state (user_id, deal_id)");
        $this->addSql("ALTER TABLE sp_news ADD thumbnail_id INT DEFAULT NULL, ADD type VARCHAR(50) DEFAULT NULL, ADD cevo_article_id INT DEFAULT NULL, DROP sitified_at");
        $this->addSql("ALTER TABLE sp_news ADD CONSTRAINT FK_CD1A065FFDFF2E92 FOREIGN KEY (thumbnail_id) REFERENCES pd_media(id) ON DELETE SET NULL");
        $this->addSql("CREATE INDEX IDX_CD1A065FFDFF2E92 ON sp_news (thumbnail_id)");
        $this->addSql("ALTER TABLE pd_sweepstakes ADD affidavit_id INT DEFAULT NULL, ADD w9form_id INT DEFAULT NULL, ADD has_optional_checkbox TINYINT(1) NOT NULL, ADD optional_checkbox_label VARCHAR(255) DEFAULT NULL, ADD event_type VARCHAR(20) NOT NULL, ADD winning_codes_count INT DEFAULT NULL, ADD consolation_codes_count INT DEFAULT NULL, ADD winner_message LONGTEXT DEFAULT NULL, ADD loser_message LONGTEXT DEFAULT NULL, ADD backup_loser_message LONGTEXT DEFAULT NULL");
        $this->addSql("ALTER TABLE pd_sweepstakes ADD CONSTRAINT FK_3DC99D98111EC0A2 FOREIGN KEY (affidavit_id) REFERENCES pd_media(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_sweepstakes ADD CONSTRAINT FK_3DC99D982AD3B6E7 FOREIGN KEY (w9form_id) REFERENCES pd_media(id) ON DELETE SET NULL");
        $this->addSql("CREATE UNIQUE INDEX UNIQ_3DC99D98111EC0A2 ON pd_sweepstakes (affidavit_id)");
        $this->addSql("CREATE UNIQUE INDEX UNIQ_3DC99D982AD3B6E7 ON pd_sweepstakes (w9form_id)");
        $this->addSql("CREATE INDEX event_type_idx ON pd_sweepstakes (event_type)");
        $this->addSql("ALTER TABLE pd_sweepstakes_entry ADD optional_checkbox_answer TINYINT(1) DEFAULT NULL, ADD created_account TINYINT(1) NOT NULL");
        $this->addSql("ALTER TABLE global_event_email ADD created_at DATETIME NOT NULL, ADD sent_to_all TINYINT(1) NOT NULL, CHANGE sent_at sent_at DATETIME DEFAULT NULL");
        $this->addSql("ALTER TABLE group_event_email ADD created_at DATETIME NOT NULL, ADD sent_to_all TINYINT(1) NOT NULL, CHANGE sent_at sent_at DATETIME DEFAULT NULL");
    }

    public function down(Schema $schema)
    {
        // this down() migration is autogenerated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() != "mysql");
        
        $this->addSql("ALTER TABLE code_assignment_code DROP FOREIGN KEY FK_7130DFC130C544BA");
        $this->addSql("ALTER TABLE pd_group_email_recipient DROP FOREIGN KEY FK_2468481F3E379065");
        $this->addSql("CREATE TABLE Thread (id VARCHAR(255) NOT NULL, permalink VARCHAR(255) NOT NULL, is_commentable TINYINT(1) NOT NULL, num_comments INT NOT NULL, last_comment_at DATETIME DEFAULT NULL, PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE comment (id INT AUTO_INCREMENT NOT NULL, thread_id VARCHAR(255) DEFAULT NULL, author_id INT DEFAULT NULL, body LONGTEXT NOT NULL, ancestors VARCHAR(1024) NOT NULL, depth INT NOT NULL, created_at DATETIME NOT NULL, INDEX IDX_9474526CE2904019 (thread_id), INDEX IDX_9474526CF675F31B (author_id), PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE group_events_attendees_gallary (groupevent_id INT NOT NULL, user_id INT NOT NULL, gallary_id INT NOT NULL, INDEX groupevent_id (groupevent_id), INDEX user_id (user_id), INDEX gallary_id (gallary_id), PRIMARY KEY(groupevent_id, user_id, gallary_id)) ENGINE = InnoDB");
        $this->addSql("ALTER TABLE comment ADD CONSTRAINT FK_9474526CE2904019 FOREIGN KEY (thread_id) REFERENCES Thread(id)");
        $this->addSql("ALTER TABLE comment ADD CONSTRAINT FK_9474526CF675F31B FOREIGN KEY (author_id) REFERENCES fos_user(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE group_events_attendees_gallary ADD CONSTRAINT group_events_attendees_gallary_ibfk_1 FOREIGN KEY (groupevent_id) REFERENCES group_event(id) ON DELETE CASCADE");
        $this->addSql("ALTER TABLE group_events_attendees_gallary ADD CONSTRAINT group_events_attendees_gallary_ibfk_2 FOREIGN KEY (user_id) REFERENCES fos_user(id) ON UPDATE CASCADE ON DELETE CASCADE");
        $this->addSql("ALTER TABLE group_events_attendees_gallary ADD CONSTRAINT group_events_attendees_gallary_ibfk_3 FOREIGN KEY (gallary_id) REFERENCES gallary(id) ON UPDATE CASCADE ON DELETE CASCADE");
        $this->addSql("DROP TABLE country_state");
        $this->addSql("DROP TABLE suspended_ip_address");
        $this->addSql("DROP TABLE code_assignment_code");
        $this->addSql("DROP TABLE code_assignment");
        $this->addSql("DROP TABLE pd_group_email");
        $this->addSql("DROP TABLE pd_group_email_recipient");
        $this->addSql("DROP TABLE promo_code_contest_consolation_code");
        $this->addSql("DROP TABLE promo_code_contest_winning_code");
        $this->addSql("DROP TABLE groupevent_media");
        $this->addSql("DROP INDEX votetype_idx ON commenting_vote");
        $this->addSql("ALTER TABLE fos_user ADD school VARCHAR(255) DEFAULT NULL, ADD major VARCHAR(255) DEFAULT NULL, ADD svicRole VARCHAR(255) DEFAULT NULL, DROP organization, DROP title, DROP industry, DROP eventRole");
        $this->addSql("ALTER TABLE global_event_email DROP created_at, DROP sent_to_all, CHANGE sent_at sent_at DATETIME NOT NULL");
        $this->addSql("ALTER TABLE group_event_email DROP created_at, DROP sent_to_all, CHANGE sent_at sent_at DATETIME NOT NULL");
        $this->addSql("ALTER TABLE pd_contest DROP hidden");
        $this->addSql("DROP INDEX user_giveaway ON pd_key_request_state");
        $this->addSql("DROP INDEX user_deal ON pd_key_request_state");
        $this->addSql("ALTER TABLE pd_sent_emails DROP errorMessage");
        $this->addSql("ALTER TABLE pd_sweepstakes DROP FOREIGN KEY FK_3DC99D98111EC0A2");
        $this->addSql("ALTER TABLE pd_sweepstakes DROP FOREIGN KEY FK_3DC99D982AD3B6E7");
        $this->addSql("DROP INDEX UNIQ_3DC99D98111EC0A2 ON pd_sweepstakes");
        $this->addSql("DROP INDEX UNIQ_3DC99D982AD3B6E7 ON pd_sweepstakes");
        $this->addSql("DROP INDEX event_type_idx ON pd_sweepstakes");
        $this->addSql("ALTER TABLE pd_sweepstakes DROP affidavit_id, DROP w9form_id, DROP has_optional_checkbox, DROP optional_checkbox_label, DROP event_type, DROP winning_codes_count, DROP consolation_codes_count, DROP winner_message, DROP loser_message, DROP backup_loser_message");
        $this->addSql("ALTER TABLE pd_sweepstakes_entry DROP optional_checkbox_answer, DROP created_account");
        $this->addSql("ALTER TABLE sp_news DROP FOREIGN KEY FK_CD1A065FFDFF2E92");
        $this->addSql("DROP INDEX IDX_CD1A065FFDFF2E92 ON sp_news");
        $this->addSql("ALTER TABLE sp_news ADD sitified_at DATETIME DEFAULT NULL, DROP thumbnail_id, DROP type, DROP cevo_article_id");
    }
}
