<?php

namespace Application\Migrations;

use Doctrine\DBAL\Migrations\AbstractMigration,
    Doctrine\DBAL\Schema\Schema;

/**
 * Auto-generated Migration: Please modify to your need!
 */
class Version20121211203554 extends AbstractMigration
{
    public function up(Schema $schema)
    {
        // this up() migration is autogenerated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() != "mysql");
        
        $this->addSql("CREATE TABLE pd_group_discussion (id INT AUTO_INCREMENT NOT NULL, group_id INT DEFAULT NULL, author_id INT DEFAULT NULL, title VARCHAR(255) NOT NULL, created DATETIME NOT NULL, updated DATETIME NOT NULL, deleted TINYINT(1) NOT NULL, deletedReason VARCHAR(255) DEFAULT NULL, content LONGTEXT DEFAULT NULL, replyCount INT DEFAULT NULL, viewCount INT DEFAULT NULL, INDEX IDX_39FF6BBBFE54D947 (group_id), INDEX IDX_39FF6BBBF675F31B (author_id), PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("CREATE TABLE pd_group_discussion_post (id INT AUTO_INCREMENT NOT NULL, author_id INT DEFAULT NULL, content LONGTEXT DEFAULT NULL, created DATETIME NOT NULL, updated DATETIME NOT NULL, deleted TINYINT(1) NOT NULL, deletedReason VARCHAR(255) DEFAULT NULL, groupDiscussion_id INT DEFAULT NULL, INDEX IDX_3C83ECC61FBDB074 (groupDiscussion_id), INDEX IDX_3C83ECC6F675F31B (author_id), PRIMARY KEY(id)) ENGINE = InnoDB");
        $this->addSql("ALTER TABLE pd_group_discussion ADD CONSTRAINT FK_39FF6BBBFE54D947 FOREIGN KEY (group_id) REFERENCES pd_groups(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_group_discussion ADD CONSTRAINT FK_39FF6BBBF675F31B FOREIGN KEY (author_id) REFERENCES fos_user(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_group_discussion_post ADD CONSTRAINT FK_3C83ECC61FBDB074 FOREIGN KEY (groupDiscussion_id) REFERENCES pd_group_discussion(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_group_discussion_post ADD CONSTRAINT FK_3C83ECC6F675F31B FOREIGN KEY (author_id) REFERENCES fos_user(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_content_report ADD groupDiscussion_id INT DEFAULT NULL, ADD groupDiscussionPost_id INT DEFAULT NULL");
        $this->addSql("ALTER TABLE pd_content_report ADD CONSTRAINT FK_E798A78E1FBDB074 FOREIGN KEY (groupDiscussion_id) REFERENCES pd_group_discussion(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_content_report ADD CONSTRAINT FK_E798A78E53A83848 FOREIGN KEY (groupDiscussionPost_id) REFERENCES pd_group_discussion_post(id) ON DELETE SET NULL");
        $this->addSql("CREATE INDEX IDX_E798A78E1FBDB074 ON pd_content_report (groupDiscussion_id)");
        $this->addSql("CREATE INDEX IDX_E798A78E53A83848 ON pd_content_report (groupDiscussionPost_id)");
        $this->addSql("ALTER TABLE pd_groups ADD discussionsEnabled TINYINT(1) NOT NULL");
        $this->addSql("ALTER TABLE pd_filtered_media DROP FOREIGN KEY FK_5B5FC3CD727ACA70");
        $this->addSql("ALTER TABLE pd_filtered_media ADD CONSTRAINT FK_5B5FC3CD727ACA70 FOREIGN KEY (parent_id) REFERENCES pd_media(id)");
    }

    public function down(Schema $schema)
    {
        // this down() migration is autogenerated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() != "mysql");
        
        $this->addSql("ALTER TABLE pd_content_report DROP FOREIGN KEY FK_E798A78E1FBDB074");
        $this->addSql("ALTER TABLE pd_group_discussion_post DROP FOREIGN KEY FK_3C83ECC61FBDB074");
        $this->addSql("ALTER TABLE pd_content_report DROP FOREIGN KEY FK_E798A78E53A83848");
        $this->addSql("DROP TABLE pd_group_discussion");
        $this->addSql("DROP TABLE pd_group_discussion_post");
        $this->addSql("ALTER TABLE pd_content_report DROP FOREIGN KEY FK_E798A78E1FBDB074");
        $this->addSql("ALTER TABLE pd_content_report DROP FOREIGN KEY FK_E798A78E53A83848");
        $this->addSql("DROP INDEX IDX_E798A78E1FBDB074 ON pd_content_report");
        $this->addSql("DROP INDEX IDX_E798A78E53A83848 ON pd_content_report");
        $this->addSql("ALTER TABLE pd_content_report DROP groupDiscussion_id, DROP groupDiscussionPost_id");
        $this->addSql("ALTER TABLE pd_filtered_media DROP FOREIGN KEY FK_5B5FC3CD727ACA70");
        $this->addSql("ALTER TABLE pd_filtered_media ADD CONSTRAINT FK_5B5FC3CD727ACA70 FOREIGN KEY (parent_id) REFERENCES pd_media(id) ON DELETE SET NULL");
        $this->addSql("ALTER TABLE pd_groups DROP discussionsEnabled");
    }
}
