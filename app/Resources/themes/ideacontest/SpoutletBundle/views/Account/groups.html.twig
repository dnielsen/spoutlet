{% extends 'UserBundle::accountLayout.html.twig' %}

{% block title %}My Groups{% endblock %}

{% block profile_content %}

    <div class="widget-100 fillWidth">

        {% include 'SpoutletBundle:Account:recTable.html.twig' with {
            'recommendations': recommendations,
            'type' : 'group'
        } %}

        <h2>
            {% if action != null %}
                <span class="left">Please select a group for your event</span>
                <span class="right"><a href="{{ path('group_new', {'then': action}) }}" class="blue">Create New Group</a></span>
            {% else %}
                <span class="left">My Groups</span>
                <span class="right"><a href="{{ path('group_new') }}" class="blue">Create New Group</a></span>
            {% endif %}
            <div class="clr"></div>
        </h2>

        <div class="text">
            <table class="myStuffTable">
            <tbody><tr>
                <th style="width:20%;">Group</th>
                <th style="width:20%;">Organizer</th>
                <th style="width:20%;">Type</th>
                <th style="width:20%">Members</th>
                <th style="width:20%">Actions</th>
            </tr>
            {% set i=0 %}
            {% for group in groups %}
                {% set i=i+1 %}
                <tr class="eventListGroup_lan{% if i%2 %} fill{% endif %}">
                    <td>
                        {% if action != null %}
                            {% if action == "group_event" %}
                                <a href="{{ path('group_event_new', { 'groupSlug': group[0].slug }) }}">{{ group[0].name }}</a>
                            {% elseif action == "campsite_event" %}
                                <a href="{{ path('idea_admin_event', { 'groupSlug': group[0].slug, 'eventId': 'newEvent' }) }}">{{ group[0].name }}</a>
                            {% else %}
                                <a href="{{ path('group_show', { 'slug': group[0].slug }) }}">{{ group[0].name }}</a>
                            {% endif %}
                        {% else %}
                            <a href="{{ path('group_show', { 'slug': group[0].slug }) }}">{{ group[0].name }}</a>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ path('profile', {'userId': group[0].owner.id}) }}">{{ group[0].owner.name }}</a>
                    </td>
                    <td>
                        {% if group[0].isPublic %}
                            <span class="label label-success">Public</span>
                        {% else %}
                            <span class="label label-warning">Private</span>
                        {% endif %}
                    </td>
                    <td>
                        {{ group[0].members|length }}
                    </td>
                    <td>
                        <a href="{{ path('group_leave', { 'slug': group[0].slug }) }}" onclick="return confirm('Are you sure you want to leave this group?');">Leave</a>
                        <br/>
                        {% if (group[0].owner == app.user) or (is_granted('ROLE_ADMIN')) %}
                            {% set numEntrySets =  group[0].entrySets|length %}
                            {% set numEvents =  group[0].numEvents %}
                            {% if not (numEntrySets > 0 or numEvents > 0) %}
                                <a href="{{ path('group_delete', { 'slug': group[0].slug }) }}" onclick="return confirm('Are you sure you want to delete this group?');">Delete</a>
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4">
                        <em>You are not in any groups. <a href="{{ path('groups') }}">Click here</a> to join a group or <a href="{{ path('group_new') }}">create your first group</a>.</em>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
{% endblock %}