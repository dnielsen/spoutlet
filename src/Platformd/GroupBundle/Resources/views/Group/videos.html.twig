{% set reportContentType    = 'GroupVideo' %}
{% set site                 = get_current_site() %}
{% set canAdd               = groupManager.isAllowedTo(app.user, group, site, 'AddVideo') %}
{% set canEdit              = groupManager.isAllowedTo(app.user, group, site, 'EditVideo') %}
{% set canDelete            = groupManager.isAllowedTo(app.user, group, site, 'DeleteVideo') %}

<div>
    {% if canAdd %}
        <a href="{{ path('group_add_video', {'id' : group.id }) }}" style="margin-left: 15px;">Add Video</a>
    {% endif %}
    {% if pages | length > 0 %}
        <div id="theater-screen-wrapper">
            <div id="theater_screen" style="width:600px; height:350px;margin: 10px 0 0 12px;">
                <video id="group_video"class="video-js vjs-default-skin"
                    controls preload="none" width="600" height="350">
                </video>
            </div>
        </div>
        <div class="scrollable" id="scrollable-videos" style="height: 140px; width: 450px; margin: 20px 0 0 87px;">
            <div class="items">

                {% set isFirstItem = true %}
                {% for page in pages %}
                    <div class="items-wrapper">
                        {% for videoList in page %}
                            {% for video in videoList %}
                                <div class="group-image-item">

                                    <div class="group-image-image">
                                        <a href="javascript:void(0);" youtube-data="{{ video.youTubeVideoId }}" style="border: none;" class="youtube-link">
                                            {% if isFirstItem %}
                                                <img src="{{ video.youTubeThumb }}" alt="{{ video.title }}" style="border: 1px solid #4a4a4a" class="active-video" />
                                                {% set isFirstItem = false %}
                                            {% else %}
                                                <img src="{{ video.youTubeThumb }}" alt="{{ video.title }}" style="border: 1px solid #4a4a4a" />
                                            {% endif %}

                                        </a>
                                        <a href="javascript:void(0);" youtube-data="{{ video.youTubeVideoId }}" class="youtube-link" title="{{ video.title }}">
                                            {{ video.title }}
                                        </a>
                                        <div class="group-image-actions">
                                        {% if canDelete %}
                                            <a href="{{ path('group_delete_video', { 'id' : group.id, 'videoId' : video.id })}}" onclick="return confirm('Are you sure you want to delete this video?');">delete</a> |
                                        {% endif %}
                                        {% if canEdit %}
                                            <a href="{{ path('group_edit_video', { 'id' : group.id, 'videoId' : video.id })}}">edit</a> |
                                        {% endif %}
                                        <a href="javascript:void(0);" class="report-content" report-data="{{ video.id }}">report</a>
                                    </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        </div>
        <div id="scroll-actions" style="margin-top: -90px;">
            <a class="prev browse video-scroll-prev" style="float: left;"></a>
            <a class="next browse video-scroll-next" style="float: right;"></a>
        </div>
    {% else %}
        <p>No videos yet... please come back later!</p>
    {% endif %}
</div>
{% include 'SpoutletBundle::_reportContentPopup.html.twig' %}
<script type="text/javascript" src="{{ asset('bundles/spoutlet/js/video-js-3.2.0/video.js') }}"></script>
<script type="text/javascript" src="{{ asset('bundles/spoutlet/js/video-js-3.2.0/youtube.js') }}"></script>
<script type="text/javascript">

    jQuery(document).ready(function() {
        _V_.options.flash.swf = '{{ asset("bundles/spoutlet/js/video-js-3.2.0/video-js.swf") }}';
        $('.youtube-link').click(function () {
           var youtubeId = $(this).attr('youtube-data');
           $('.youtube-link').find('img').removeClass('active-video');
           $(this).find('img').addClass('active-video');
           _V_("group_video").src({type: 'video/youtube', src: 'http://www.youtube.com/watch?v=' + youtubeId});
           _V_("group_video").play();
        });

        if($('.youtube-link').length > 0) {
            _V_("group_video", {techOrder: ["html5","flash","youtube"]}, function() {
                this.src({type: 'video/youtube', src: 'http://www.youtube.com/watch?v=' + $('.youtube-link').first().attr('youtube-data') });
                this.play();
            });
        }
    });

</script>
