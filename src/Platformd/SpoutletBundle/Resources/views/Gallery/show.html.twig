{% extends 'SpoutletBundle::layout.html.twig' %}

{% set reportContentType    = 'GalleryMedia' %}
{% set mediaId              = media.id %}

{% set site                 = get_current_site() %}
{% set canFeature           = media.isAllowedTo(app.user, site, 'FeatureMedia') %}
{% set canEdit              = media.isAllowedTo(app.user, site, 'EditMedia') %}
{% set canDelete            = media.isAllowedTo(app.user, site, 'DeleteMedia') %}
{% set openGraphThumb       = app.request.getScheme ~ '://' ~ app.request.getHost ~ media_path(media.image, {'local': true}) | imagine_filter('image_thumb_small') %}

{% block open_graph %}
    <meta property="fb:app_id" content="{{ facebook_app_id }}">
    <meta property="og:title" content="{{ media.title }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ app.request.getUri }}" />
    <meta property="og:site_name" content="Alienware Arena" />
    <meta property="og:image" content="{{ openGraphThumb }}" />
    <meta property="og:description" content="{{ media.description }}" />
{% endblock %}

{% block title media.title %}

{% block content %}
<h3 style="padding-bottom: 10px;">{{ media.title }}</h3>
<div class="media-show-page">
    <div class="std_2col" style="padding:0 0 10px 0">
        <div class="left">
            <div style="padding: 3px 0 3px 0;float:left;">
                <a href="{{ path('gallery_index') }}">Photo Gallery</a>
                <span style="color:#B3B3B3;padding:0 2px 0 2px;">></span>
                {% if crumb %}
                <a href="{{ crumb['value'] }}">{{ crumb['text'] }}</a>
                <span style="color:#B3B3B3;padding:0 2px 0 2px;">></span>
                {% endif %}

                <span style="color:#B3B3B3">{{ media.title }}</span>
            </div>

        </div>
        <div class="right">

            {{ 'galleries.submit_photo_now' | trans }}
            <div class="submit-media" style="display: inline; margin-left: 5px;">
                <a href="{{ path('gallery_submit') }}" class="btn btn-primary" id="gallery-show-submit-media">{{ 'galleries.submit_photo_page_title' | trans }}</a>
            </div>

        </div>
    </div>
    <div class="std_2col" style="min-height: 500px; margin-top: 10px;">
        <div class="left">

            <img id="main-photo" src="{{ media_path(media.image, {'local': true}) | imagine_filter('media_photo_show') }}" alt="{{ media.title }}" style="display:none;" />

        </div>

        <div class="right">

            <div id="media-social" style="margin-top: 0px; margin-bottom: 5px;">
                <div class="fb-like"
                    data-send="false"
                    data-width="300"
                    data-layout="button_count"
                    data-show-faces="false"
                    data-colorscheme="dark"
                    style="vertical-align:top;zoom:1;*display:inline">
                </div>
                <div class="fb-send" data-font="arial" data-colorscheme="dark" style="vertical-align:top;zoom:1;*display:inline"></div>
                    <a href="https://twitter.com/share" class="twitter-share-button" data-via="Alienware">Tweet</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

            </div>

             {% if (otherMediaPages | length) > 0 %}

             <div class="other-media" style="margin-bottom: 20px;">
                <a id="nav-prev" class="nav-prev" style="float: left;"></a>
                <div class="scrollable" id="scrollable-other-media">

                    <div class="items">
                        {% for page in otherMediaPages %}
                            <div class="items-wrapper">
                            {% for media in page %}
                                <div class="user-media-thumb-wrapper">
                                   <div class="gallery-media-thumb-square">
                                        <a href="{{ path('gallery_media_show', { id: media.id }) }}">
                                            <img style="width:82px; height:82px;" class="media-thumb" data-title="{{ media.title }}" title="{{ media.title }}" src="{{ media_path(media.image, {'local': true}) | imagine_filter('media_photo_thumb_square') }}" />
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <a id="nav-next" class="nav-next" style="float: right; margin-top: -93px;"></a>
            </div>

            {% endif %}

            <div class="widget-33" style="height:auto; margin-bottom: 10px;">
                <div class="widget-header">
                    <div class="widget-title">
                        {{ 'galleries.show_photo_details_label' | trans }}
                    </div>
                </div>
                <div class="widget-content">
                    <div class="photo-author">
                        <img src="{{ asset(get_avatar_url(media.author)) }}" alt="{{ media.author.username }}" />
                        <div class="photo-author-link"><a href="{{ path('accounts_profile', {username: media.author.username}) }}">{{ media.author.username }}</a></div>
                    </div>

                    <div class="photo-voting-wrapper">
                        <div class="photo-votes upvotes">
                            <div class="votes"><strong><span id="media-upvotes">{{ upVotes }}</span>%</strong></div>
                            <div>Likes</div>
                        </div>

                       <div class="photo-votes downvotes">
                            <div class="votes"><strong><span id="media-downvotes">{{ downVotes }}</span>%</strong></div>
                            <div>Dislikes</div>
                        </div>

                        {% if media.hasUserVoted(app.user) == false and media.canUserVote(app.user) == true %}

                            <div class="media-voting-wrapper">
                                <span>Cast your vote: </span>
                                {% include 'SpoutletBundle:Gallery:_mediaVoting.html.twig' %}
                            </div>

                            <div id="media-voting-login-required" style="display: none; margin-top: 35px; padding: 0 20px;">
                                <a href="http://alienwarearena.com/account/login?return={{ app.request.uri | url_encode }}">Login</a>
                            </div>
                        {% endif %}

                        <div id="media-voting-success" style="display:none;margin-top:35px;">Thank you for voting!</div>
                    </div>

                    <div class="photo-date">{{ media.createdAt | date('M j, Y')}}</div>
                    <p>
                            {% if canDelete %}
                                <a href="{{ path('gallery_delete_media', { 'id' : media.id })}}" onclick="return confirm('Are you sure you want to delete this item?');">delete</a> |
                            {% endif %}
                            {% if canEdit %}
                                <a href="{{ path('gallery_edit_media', { 'id' : media.id })}}">edit</a> |
                            {% endif %}
                            {% if canFeature %}
                                <a href="{{ path('gallery_feature_media', { 'id' : media.id })}}" onclick="return confirm('Are you sure you want to feature this item?');">
                                {% if media.featured == false %}
                                    feature
                                {% else %}
                                    unfeature
                                {% endif %}
                                </a>
                            {% endif %}
                        </p>
                    <div class="description">{{ media.description }}</div>
                    <div class="photo-views">{{ 'galleries.show_photo_details_views' | trans}} {{ media.views | number_format(0, '.', ',') }} | {{ 'galleries.show_photo_details_points' | trans}} {{ points | number_format(0, '.', ',') }}</div>

                    <div style="margin-top:10px; width:300px">
                        <div style="width:20%; float:left;">Galleries: </div>
                        <div style="width:80%; float:right;">
                            {% for gallery in media.galleries %}
                                <a href="{{ path('gallery_gallery_show', { 'slug' : gallery.slug }) }}">{{ gallery.name }}</a><br />
                            {% endfor %}
                        </div>
                        <div class="clear" />
                    </div>

                    <div id="widget-footer">
                        <p>
                            <a href="javascript:void(0);" class="report-content" report-data="{{ media.id }}">Report</a>
                        </p>
                    </div>
                    {% if media.hasUserVoted(app.user) %}
                        <div style="width:290px;padding:5px 0;">
                            <p class="alert alert-info help" style="margin:0;"><i class="icon-info-sign"></i>
                                {{ 'galleries.already_voted' | trans }}
                            </p>
                        </div>

                    {% elseif media.canUserVote(app.user) == false  %}
                        <div style="width:290px;padding:5px 0;">
                            <p class="alert alert-info help" style="margin:0;"><i class="icon-info-sign"></i>
                                {{ 'galleries.ineligible_due_to_contest' | trans }}
                            </p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div style="margin-top: 30px;">
                {% include 'SpoutletBundle:Default:_dealsAd.html.twig' %}
            </div>

        </div>

    </div>
</div>

{% include 'SpoutletBundle::_reportContentPopup.html.twig' %}

{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" type="text/css" href="{{ asset('plugins/jquery.ad-gallery/jquery.ad-gallery.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/spoutlet/css/galleries.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/spoutlet/css/forms.css') }}" />
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="/bundles/spoutlet/js/jquery.tools.min.js"></script>
    <script src="{{ asset('bundles/spoutlet/js/jquery.imagesloaded.min.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {

            $('.gallery-media-thumb-small').hover(
                function () {

                    $(this).addClass('active');
                },
                function () {
                    $(this).removeClass('active');
                }
            );

            $('#main-photo').imagesLoaded(function () {
                $(this).fadeIn('slow');
            });

            $('.media-title').truncate({
                width: 115,
            });

            $('#scrollable-other-media').scrollable({
                next: '#nav-next',
                prev: '#nav-prev'
            });
        });
    </script>
{% endblock %}
