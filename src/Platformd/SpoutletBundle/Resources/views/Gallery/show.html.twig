{% extends 'SpoutletBundle::layout.html.twig' %}

{% set reportContentType    = 'GalleryMedia' %}
{% set mediaId              = media.id %}

{% set site                 = get_current_site() %}
{% set canFeature           = media.isAllowedTo(app.user, site, 'FeatureMedia') %}
{% set canEdit              = media.isAllowedTo(app.user, site, 'EditMedia') %}
{% set canDelete            = media.isAllowedTo(app.user, site, 'DeleteMedia') %}
{% set openGraphThumb       = app.request.getScheme ~ '://' ~ app.request.getHost ~ media_path(media.image, {'local': true}) | imagine_filter('image_thumb_small') %}

{% block open_graph %}
    <meta property="fb:app_id" content="{{ facebook_app_id }}">
    <meta property="og:title" content="{{ media.title }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ app.request.getUri }}" />
    <meta property="og:site_name" content="Alienware Arena" />
    <meta property="og:image" content="{{ openGraphThumb }}" />
    <meta property="og:description" content="{{ media.description }}" />
{% endblock %}

{% block title media.title %}

{% block content %}
<h3 style="padding-bottom: 10px;">{{ media.title }}</h3>
<div class="media-show-page">
    <div class="std_2col" style="padding:0 0 10px 0">
        <div class="left">
            <div style="padding: 3px 0 3px 0;float:left;">
                <a href="{{ path('gallery_index') }}">Photo Gallery</a>
                <span style="color:#B3B3B3;padding:0 2px 0 2px;">></span>
                {% if crumb %}
                <a href="{{ crumb['value'] }}">{{ crumb['text'] }}</a>
                <span style="color:#B3B3B3;padding:0 2px 0 2px;">></span>
                {% endif %}

                <span style="color:#B3B3B3">{{ media.title }}</span>
            </div>

        </div>
        <div class="right">
        <div id="media-social">
            <div class="fb-like"
                data-send="false"
                data-width="300"
                data-layout="button_count"
                data-show-faces="false"
                data-colorscheme="dark"
                style="vertical-align:top;zoom:1;*display:inline">
            </div>
            <div class="fb-send" data-font="arial" data-colorscheme="dark" style="vertical-align:top;zoom:1;*display:inline"></div>
                <a href="https://twitter.com/share" class="twitter-share-button" data-via="Alienware">Tweet</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        </div>
        </div>
    </div>
    <div class="std_2col" style="min-height: 500px;">
        <div class="left">

            <img id="main-photo" src="{{ media_path(media.image, {'local': true}) | imagine_filter('media_photo_show') }}" alt="{{ media.title }}" style="display:none;" />

            {% if (otherMedia | length) > 0 %}

                <p>
                    {{ 'galleries.more_images_from' | trans }} <a href="{{ path('accounts_profile', {username: media.author.username}) }}">{{ media.author.username }}</a>
                </p>

                <div class="page_container">
                    <div class="gallery-items content" style="width:636px;">
                        {% for media in otherMedia %}
                            {% set isFirstInRow = (loop.index - 1) is divisibleby(5) or loop.first  %}
                            <div class="user-media-thumb-wrapper{% if isFirstInRow %} first-media{% endif %}">
                                <div class="gallery-media-thumb-small">
                                    <a href="{{ path('gallery_media_show', { id: media.id }) }}">
                                        <img class="media-thumb" title="{{ media.title }}" src="{{ media_path(media.image, {'local': true}) | imagine_filter('media_photo_thumb') }}" />
                                    </a>
                                </div>
                                <div style="width:115px;">
                                    <a class="media-title" href="{{ path('gallery_media_show', { id: media.id }) }}">{{ media.title }}</a>
                                </div>
                                <input type="hidden" value="{{ media.createdAt | date('m-d-Y') }}" class="media-date" />
                                <input type="hidden" value="{{ media.views }}" class="media-popular" />
                            </div>
                        {% endfor %}
                    </div>
                    <div class="page_navigation" style="float: right; padding-top: 10px;"></div>
                </div>
            {% endif %}
        </div>

        <div class="right">
            <div class="widget-33" style="height:auto;">
                <div class="widget-header">
                    <div class="widget-title">
                        {{ 'galleries.show_photo_details_label' | trans }}
                    </div>
                </div>
                <div class="widget-content">
                    <div class="photo-author">
                        <img src="{{ asset(get_avatar_url(media.author)) }}" alt="{{ media.author.username }}" />
                        <div class="photo-author-link"><a href="{{ path('accounts_profile', {username: media.author.username}) }}">{{ media.author.username }}</a></div>
                    </div>
                    <div class="photo-date">{{ 'galleries.show_photo_details_upload_on' | trans }} {{ media.createdAt | date('M d, Y')}}</div>
                    <div class="description">{{ media.description }}</div>

                    <div style="margin-top:10px; width:300px">
                        <div style="width:20%; float:left;">Galleries: </div>
                        <div style="width:80%; float:right;">
                            {% for gallery in media.galleries %}
                                <a href="{{ path('gallery_gallery_show', { 'slug' : gallery.slug }) }}">{{ gallery.name }}</a><br />
                            {% endfor %}
                        </div>
                        <div class="clear" />
                    </div>

                    <div id="widget-footer">
                        <p>
                            {% if canDelete %}
                                <a href="{{ path('gallery_delete_media', { 'id' : media.id })}}" onclick="return confirm('Are you sure you want to delete this item?');">delete</a> |
                            {% endif %}
                            {% if canEdit %}
                                <a href="{{ path('gallery_edit_media', { 'id' : media.id })}}">edit</a> |
                            {% endif %}
                            {% if canFeature %}
                                <a href="{{ path('gallery_feature_media', { 'id' : media.id })}}" onclick="return confirm('Are you sure you want to feature this item?');">
                                {% if media.featured == false %}
                                    feature
                                {% else %}
                                    unfeature
                                {% endif %}
                                </a>
                            {% endif %}
                        </p>
                        <p>
                            <a href="javascript:void(0);" class="report-content flag" report-data="{{ media.id }}">Report</a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="widget-33" style="height:auto;margin-top:10px;">
                <div class="widget-header">
                    <div class="widget-title">
                        {{ 'galleries.show_photo_vote_label' | trans }}
                    </div>
                </div>
                <div class="widget-content">

                    <div style="display:inline-table;width:120px;margin-left:5px;">
                        {{ 'galleries.show_photo_details_views' | trans}} {{ media.views }}
                    </div>
                    <div style="display:inline-table;width:160px;">
                        Likes: <span id="media-upvotes">{{ upVotes }}</span>% / Dislikes: <span id="media-downvotes">{{ downVotes }}</span>%
                    </div>
                    {% include 'SpoutletBundle:Gallery:_mediaVoting.html.twig' %}
                </div>
            </div>
            <div class="submit-media">
                <a href="{{ path('gallery_submit') }}" class="btn btn-primary">{{ 'galleries.submit_photo_page_title' | trans }}</a>
            </div>

        </div>
    </div>
</div>

{% include 'SpoutletBundle::_reportContentPopup.html.twig' %}

{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" type="text/css" href="{{ asset('plugins/jquery.ad-gallery/jquery.ad-gallery.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/spoutlet/css/galleries.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/spoutlet/css/forms.css') }}" />
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/spoutlet/js/jquery.pajinate.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/spoutlet/js/jquery.imagesloaded.min.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {

            $('#main-photo').imagesLoaded(function () {
                $(this).fadeIn('slow');
            });

            $('.media-title').truncate({
                width: 115,
            });

            $('.page_container').pajinate({
                    items_per_page: 5,
                    show_first_last: false,
                });
        });
    </script>
{% endblock %}
