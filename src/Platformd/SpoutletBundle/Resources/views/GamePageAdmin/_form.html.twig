{% form_theme form 'SpoutletBundle:Admin:normalLabel.html.twig' %}
{% form_theme form 'SpoutletBundle:Admin:_bootstrapForms.html.twig' %}

<div class="game-page-form">
    {{ form_errors(form) }}

    <fieldset>
        <legend>a) Basic Information</legend>

        <div class="row-fluid first">
            <div class="span6">
                {{ form_row(form.game) }}
                {{ form_row(form.slug) }}
                {{ form_row(form.createdAt) }}
            </div>
            <div class="span6">
                {{ form_row(form.locales) }}
                {{ form_row(form.status) }}
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>b) (optional) Images</legend>

        <div class="row-fluid first">
            <div class="span6">
                {{ form_row(form.buttonImage1) }}
            </div>
            <div class="span6">
                {{ form_row(form.buttonUrl1) }}
            </div>
            <div class="clear"></div>
        </div>

        <div class="row-fluid">
            <div class="span6">
                {{ form_row(form.buttonImage2) }}
            </div>
            <div class="span6">
                {{ form_row(form.buttonUrl2) }}
            </div>
        </div>

        <div class="row-fluid">
            <div class="span6">
                {{ form_row(form.backgroundImage) }}
            </div>
            <div class="span6">

            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>c) Details</legend>

        <div class="row-fluid first">
            <div class="span6">
                {{ form_row(form.aboutGame) }}
                {{ form_row(form.legalVerbiage) }}
            </div>
            <div class="span6">
                {{ form_row(form.keyFeature1) }}
                {{ form_row(form.keyFeature2) }}
                {{ form_row(form.keyFeature3) }}
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>d) Videos</legend>

        <div class="row-fluid first">
            <div class="span6">
                {{ form_row(form.youtubeIdTrailer1) }}
            </div>
            <div class="span6">
                {{ form_row(form.youtubeIdTrailer2) }}
            </div>
        </div>

        <div class="row-fluid">
            <div class="span6">
                {{ form_row(form.youtubeIdTrailer3) }}
            </div>
            <div class="span6">
                {{ form_row(form.youtubeIdTrailer4) }}
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>e) Media Gallery</legend>

        <ul class="medias-list clearfix row-fluid" data-prototype="{{ form_widget(form.mediaGalleryMedias.get('prototype')) | e }}">
            {# see the CSS file this explanation #}
            <li class="dummy"></li>
            {% for mediaForm in form.mediaGalleryMedias %}
                <li class="span5 image-li existing-element">{{ form_row(mediaForm) }}</li>

                {% if loop.index is even %}
                    <li class="clear"></li>
                {% endif %}
            {% endfor %}
        </ul>

        {# this prints an empty div, but it's necessary, otherwise form_rest tries to print this, which prints a logo #}
        {{ form_widget(form.mediaGalleryMedias) }}
    </fieldset>

    {{ form_rest(form) }}
</div>

{% block javascripts %}
    <script type="text/javascript">
        function addTagForm(collectionHolder, $newLinkLi) {
            // Get the data-prototype we explained earlier
            var prototype = collectionHolder.attr('data-prototype');

            // Replace '$$name$$' in the prototype's HTML to
            // instead be a number based on the current collection's length.
            var newForm = prototype.replace(/\$\$name\$\$/g, collectionHolder.children().length);

            // Display the form in the page in an li, before the "Add a tag" link li
            var $newFormLi = $('<li class="span5 image-li"></li>').append(newForm);
            $newFormLi.hide();
            $newLinkLi.before($newFormLi);
            $newFormLi.fadeIn();

            // a bit ugly, but we need a clear after each "row"
            if ((collectionHolder.find('.image-li').length % 2) == 0) {
                $newLinkLi.before($('<li class="clear"></li>'));
            }
        }

        jQuery(document).ready(function() {
            // Get the div that holds the collection of tags
            var collectionHolder = $('ul.medias-list');

            // setup an "add a tag" link
            var $addTagLink = $('<div class="wrap"><a href="#" class="add_tag_link btn btn-primary"><i class="icon-plus icon-white"></i> Upload another</a></div>');
            var $newLinkLi = $('<li class="span5 new-link"></li>').append($addTagLink);

            jQuery(document).ready(function() {
                // add the "add a tag" anchor and li to the tags ul
                collectionHolder.append($newLinkLi);

                $addTagLink.on('click', function(e) {
                    // prevent the link from creating a "#" on the URL
                    e.preventDefault();

                    // add a new tag form (see next code block)
                    addTagForm(collectionHolder, $newLinkLi);
                });
            });
        });
    </script>
{% endblock %}