{% extends 'SpoutletBundle::layout.html.twig' %}

{% block title 'Groups - ' ~ group.name %}

{% set openGraphThumb = app.request.getScheme ~ '://' ~ app.request.getHost ~ '/bundles/spoutlet/images/groups/groups_og.jpg' %}
{% set site = get_current_site() %}

{% block open_graph %}
    <meta property="fb:app_id" content="{{ facebook_app_id }}">
    <meta property="og:title" content="{{ 'groups.opengraph.title' | trans }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ app.request.getUri }}" />
    <meta property="og:site_name" content="Alienware Arena" />
    <meta property="og:image" content="{{ openGraphThumb }}" />
    <meta property="og:description" content="{{ 'groups.opengraph.description' | trans }}" />
{% endblock %}

{# either set the custom background image, or leave it to false #}
{% if group.backgroundImage %}
    {% set customPageBackgroundImage = media_path(group.backgroundImage) %}
{% else %}
    {% set customPageBackgroundImage = false %}
{% endif %}

{% block page_background_image customPageBackgroundImage %}

{% block content %}
<div class="std_1col" style="padding: 0;">
    <div id="group-avatar">
        {% if group.groupAvatar %}
            <a href="{{ path('group_show', {'id' : group.id }) }}"><img src="{{ media_path(group.groupAvatar) }}" /></a>
        {% else %}
            <a href="{{ path('group_show', {'id' : group.id }) }}"><img src="/bundles/spoutlet/images/groups/group_default_avatar.jpg" /></a>
        {% endif %}
    </div>
</div>
<div class="std_1col" style="padding: 0;">
    <div class="groups-sub-nav-wrapper">
        {% include 'SpoutletBundle:Group:_subNav.html.twig' %}
    </div>
</div>
<div class="std_2col">
    <div class="right">
        {% if group.isAllowedTo(app.user, site, 'JoinGroup') %}
        <div class="join-group-options">
            <form action="{{ path('group_join', { 'id': group.id }) }}">
                <button id="join-group-button" type="submit" ></button>
            </form>
        </div>
        {% endif %}
        <div class="widget-33" style="height: auto; margin-bottom: 10px;">
            <div class="widget-header">
                <div class="widget-title">
                    {{ group.name }}
                </div>
            </div>
            <div class="widget-content">

                <div id="group-member-count">
                    {{ group.members.count }}
                    <div>Members</div>
                </div>
                <div id="group-comment-count">
                    {{ commentTotal }}
                    <div>Comments</div>
                </div>

                <div id="group-like-wrapper">
                    <div class="fb-like" data-send="false" data-width="300" data-layout="button_count" data-show-faces="false" data-colorscheme="dark"></div>
                </div>

                <div id="group-invite-wrapper"><a href="javascript:void(0);" id="group-invite">Invite Friends</a></div>

                {% if group.location and group.category == 'location' %}
                <div id="group-location-address" class="location-info">
                    <div>ADDRESS:</div>
                    <div id="street-address1">
                        {{ group.location.address1 }}
                    </div>
                    <div id="street-address2">
                        {{ group.location.address2 }}
                    </div>
                    <div id="city">
                        {{ group.location.city }}
                    </div>
                    <div id="state">
                        {{ group.location.stateProvince }}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% if group.location and group.category == 'location' %}
            <input id="location-value" type="hidden" value="{{ group.location.getFormattedLocation }}" />
            <div id="google-map-location"></div>
        {% endif %}
        {% include 'SpoutletBundle:Default:_dealsAd.html.twig' %}
    </div>
    <div class="left">
        <div class="widget-66" id="featured-content" style="min-height: 500px;">
            <div class="featured-content-header">
                <a href="javascript:void(0);" id="group-news" class="active">News</a>
                <a href="javascript:void(0);" id="group-images">Images</a>
                <a href="javascript:void(0);" id="group-videos">Videos</a>
                <a href="javascript:void(0);" id="group-about">About</a>
                <div style="clear: left;"></div>
            </div>
            <div class="widget-content">
                <div id="content-group-news" class="featured-content-category active">

                </div>
                <div id="content-group-images" class="featured-content-category">

                </div>
                <div id="content-group-videos" class="featured-content-category">

                </div>
                <div id="content-group-about" class="featured-content-category" style="height: 500px;">
                    {% include 'SpoutletBundle:Group:_about.html.twig' %}
                </div>
            </div>
        </div>
        <div id="group-comments">
            {% render "FOSCommentBundle:Thread:showFlat" with {"id": group.threadId } %}
        </div>
    </div>

</div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/spoutlet/css/groups.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/spoutlet/css/jquery.mCustomScrollbar.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/spoutlet/css/forms.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/spoutlet/css/lightbox.css') }}" />
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="/bundles/spoutlet/js/jquery.mousewheel.min.js"></script>
    <script type="text/javascript" src="/bundles/spoutlet/js/jquery.mCustomScrollbar.js"></script>
    <script type="text/javascript" src="/bundles/spoutlet/js/jquery.resize.min.js"></script>
    <script type="text/javascript" src="/bundles/spoutlet/js/lightbox.js"></script>
    <script type="text/javascript" src="/bundles/spoutlet/js/jquery.expander.min.js"></script>
    <script type="text/javascript" src="/bundles/spoutlet/js/jquery.tools.min.js"></script>

    {% if group.location and group.category == 'location' %}
        <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&sensor=true"></script>
        <script type="text/javascript" src="/bundles/spoutlet/js/jquery.groupsmaps.js"></script>
        <script type="text/javascript">
            $(function () {
                $('#google-map-location').groupsmap({
                    address : $('#location-value').val()
                });
            });
        </script>
    {% endif %}
    <script type="text/javascript">
        $(function () {

            $('#group-invite').click(function () {
                FB.ui({
                    method: 'send',
                    name: "You are invited to the {{ group.name | raw }}!",
                    link: '{{ path('group_show', { 'id': group.id })  | absolute_url }}',
                    description: "Check out Alienware Arena's Groups! Join a wide variety of gamer related communities and share your thoughts on your favorite topics.",
                    image: '{{ openGraphThumb }}'
                });
            });

            var hash = window.location.hash.replace('#','');

            var tab = 'group-' + hash;

            var loadVideoContent = function(id) {
                var content = $('.featured-content-category#content-'+id);
                $.ajax({
                    url: '{{ path('group_videos', { 'id' : group.id }) }}',
                    method: 'get',
                    success: function(data, textStatus, jqXHR) {
                        content.html(data);
                        $("#scrollable-videos").scrollable();
                    }
                });
            }

            var loadNewsContent = function(id) {
                var content = $('.featured-content-category#content-'+id);
                $.ajax({
                    url: '{{ path('group_news', { 'id' : group.id }) }}',
                    method: 'get',
                    success: function(data, textStatus, jqXHR) {
                        content.html(data);
                    }
                });
            }

            var loadImageContent = function(id) {
                var content = $('.featured-content-category#content-'+id);
                $.ajax({
                    url: '{{ path('group_images', { 'id' : group.id }) }}',
                    method: 'get',
                    success: function(data, textStatus, jqXHR) {
                        content.html(data);
                        $("#scrollable-images").scrollable();
                    }
                });
            }

            var loadContent = function(tab) {
                if(tab == 'group-') {
                    tab = 'group-news';
                }

                $('#' + tab).click();
            }

            $(".featured-content-header a").click(function() {

                var current = $('.featured-content-header a.active').attr('id');
                var id = $(this).attr('id');

                window.location.hash = id.replace('group-', '');

                $('.featured-content-header a.active').removeClass('active');
                $(this).addClass('active');
                $('.featured-content-category#content-'+current).fadeOut('fast', function () {
                    $('.report-wrapper').remove();

                    var content = $('.featured-content-category#content-'+id);

                    switch(id) {
                        case 'group-videos':
                            loadVideoContent(id);
                            break;
                        case 'group-news':
                            loadNewsContent(id);
                            break;
                        case 'group-images':
                            loadImageContent(id);
                            break;
                        case 'group-about':
                            content.resize();
                            content.mCustomScrollbar('update');
                            break;
                    }

                    $(this).delay(500);
                    content.fadeIn();
                });
            });
            $('#content-group-about').mCustomScrollbar();
            loadContent(tab);
        });
    </script>

{% endblock %}
