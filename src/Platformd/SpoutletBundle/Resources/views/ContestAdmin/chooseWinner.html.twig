{% extends 'SpoutletBundle::adminLayout.html.twig' %}

{% block content %}
<h1>Choose Winner for {{ contest.name }}</h1>

{% if (contest.votingEnd | date < 'now' | date) and (contest.winner == null) %}

<p class="alert alert-info help"><i class="icon-info-sign"></i>
    The entries are shown below. Please select up to 3 winners.
</p>

<form action="{{ path('admin_contest_confirm_winner', { 'slug' : contest.slug }) }}" method="post" class="form-horizontal">

<table class="table table-striped table-bordered tablesorter">
    <thead>
        <tr>
            <th>Image</th>
            <th>URL</th>
            <th>Username</th>
            <th>Entry Date</th>
            <th>Votes</th>
            <th>Country</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>

    {% if entries | length < 1 %}

        <tr>
            <td colspan=6>No entries found!</td>
        </tr>

    {% else %}

        {% for entry in entries %}
            <tr>
                <td><img src="{{ media_path(entry.image, {'local': true}) | imagine_filter('game_show_logo') }}" alt="{{ entry.title }}" /></td>
                <td><a target="_blank" href="{{ media_path_nice(entry.image) }}">{{ media_path_nice(entry.image) }}</a></td>
                <td>{{ entry.author.username }}</td>
                <td>{{ entry.createdAt | date }}</td>
                <td>{{ entry.id in votes|keys ? votes[entry.id] : 0 }}</a></td>
                <td>{{ entry.author.country }}</td>
                <td>
                    <input type="radio" name="first_place" value="{{ entry.id }}">1st place<br />
                    <input type="radio" name="second_place" value="{{ entry.id }}">2nd place<br />
                    <input type="radio" name="third_place" value="{{ entry.id }}">3rd place<br />
                </td>
            </tr>
        {% endfor %}

    {% endif %}

    </tbody>
</table>

<button type="submit" class="btn btn-primary choose-winners" formnovalidate>Submit</button>

{% else %}

<p class="alert alert-info help"><i class="icon-info-sign"></i>
    Voting for this contest has not finished yet. Please either wait for the contest to end or edit the contest so that it has already ended.
</p>

{% endif %}

<script type="text/javascript">
    $(function () {
        $("table").tablesorter({
            sortList: [[4,1]]
        });
    });

    jQuery(function($) {
        $("button.choose-winners").bind("click", function(event) {
            if (!$("first_place").checked) {
                alert("You have not selected a first place entry");
                event.stopPropagation();
                event.preventDefault();

                return false;
            }

            if ($("first_place").checked && $("third_place").checked && !$("second_place").checked) {
                alert("You have selected a third palce entry without awarding second place");
                event.stopPropagation();
                event.preventDefault();

                return false;
            }
        })
    });
</script>

{% endblock %}
