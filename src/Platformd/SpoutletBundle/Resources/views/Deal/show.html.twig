{% extends 'SpoutletBundle::layout.html.twig' %}

{% block stylesheets %}
    {{ parent() }}

    <link rel="stylesheet" href="{{ asset('plugins/jquery.ad-gallery/jquery.ad-gallery.css') }}" />
    <link rel="stylesheet" href="{{ asset('bundles/spoutlet/css/deals.css') }}" />
{% endblock %}

{% block title deal.name ~ ' '~ ('deal' | trans) %}

{% block open_graph %}
    <meta property="fb:app_id" content="{{ facebook_app_id }}">
    <meta property="og:title" content="{{ deal.name }}" />
    <meta property="og:type" content="product" />
    <meta property="og:url" content="{{ app.request.getUri }}" />
    <meta property="og:site_name" content="Alienware Arena" />
    {% if deal.openGraphOverride.thumbnail %}
        <meta property="og:image" content="{{ deal.openGraphOverride.thumbnail | media_path }}" />
    {% endif %}
    {% if deal.openGraphOverride.description %}
        <meta property="og:description" content="{{ deal.openGraphOverride.description | striptags }}" />
    {% endif %}
{% endblock %}

{% block content %}
    <div class="deals-header" style="background: url('{{ media_path(deal.banner) }}')">
            <div class="deals-timeleft" style="display: none;">
                {% if deal.endsAt > date() %}
                <input id="deal-ends-date" type="hidden" value="{{ deal.endsAt | date('Y/m/d h:m:s') }}" />
                <div id="time-left">
                    <span id="deals-timeleft-label">{{ 'deal_timeleft_label' | trans }}</span>
                    <span id="deals-daysleft">{dn}</span>
                    <span id="deals-daysleft-label" class="timeleft-label">{dl}</span>
                    <span id="deals-hoursleft">{hn}</span>
                    <span id="deals-hoursleft-label" class="timeleft-label">{hl}</span>
                    <span id="deals-minutesleft">{mn}</span>
                    <span id="deals-minutesleft-label" class="timeleft-label">{ml}</span>
                    <span id="deals-secondsleft">{sn}</span>
                    <span id="deals-secondsleft-label" class="timeleft-label">{sl}<span>
                </div>
                {% else %}
                    <span>{{ 'deal_timeleft_expired_label' | trans }}</span>
                {% endif %}
            </div>
    </div>
    <div id="deal-features-instructions">
        <table id="features-instructions" style="border-spacing: 3px;">
            <thead>
                <tr>
                    <th class="deals-features-col-header">
                        {{ deal.name }}</th>
                    <th class="deals-instructions-col-header">
                        {{ 'deal_instructions_table_header' | trans }}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="deals-features-col">
                        {% if deal.description %}
                            <p>{{ deal.description | raw }}</p>
                        {% endif %}
                        {% if deal.websiteUrl %}
                        <div id="deal-websiteurl">
                            <a href="{{ deal.websiteUrl }}" {% if deal.visitWebsiteButton %} style="background: url('{{ media_path(deal.visitWebsiteButton)}}') no-repeat; display: block; width: 224px; height: 43px; margin: 0px auto;" {% endif %} target="_blank"></a>
                        </div>
                        {% endif %}
                    </td>
                    <td class="deals-instructions-col">
                        <div id="deal-actions">
                            <div id="deal-countries">
                                <select id="deal-countries">
                                    <option value="1">United States</option>
                                    <option value="2">Canada</option>
                                    <option value="3">Mexico</option>
                                </select>
                            </div>
                            <button id="deal-redeem-button" {% if deal.claimCodeButton %} style="background: url('{{ media_path(deal.claimCodeButton) }}') no-repeat; border: none;" {% endif %}></button>
                        </div>
                        <div id="deal-instructions">
                            <ul>
                                {% include 'SpoutletBundle:Deal:_steps.html.twig' with {'deal': deal} %}
                                {% if  (redemptionSteps is not empty)  %}
                                {% for redemptionStep in redemptionSteps %}
                                <li>
                                    <span class="step-number">{{ 'deal_instructions_step' | trans}} {{ loop.index + 1 }}:</span>
                                    <span class="item controlled-spacing">{{ redemptionStep | raw }}</span>
                                </li>
                                {% endfor %}
                                {% endif %}
                            </ul>
                        </div>
                        <div id="deals-recommend">
                            <div class="fb-like" data-send="false" data-width="350" data-show-faces="false" data-colorscheme="dark" data-action="like"></div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="deal-code-display">
        {% if userAlreadyRedeemed %}
        <p>
            {{ 'deal_redeem_success' | trans }}
        </p>

        <p class="notice-data">
            {{ 'deal_redeem_code' | trans }}: {{ dealCode }}
        </p>
    {% else %}
        <a href="{{ path('deal_redeem', { "slug" : deal.slug }) }}">Click here to redeem</a>
    {% endif %}
    </div>

    <div class="deal-show-page">
        <div class="std_2col">
            <div>
                <h1>
                    {{ deal.name }}
                </h1>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $(function() {
            var endsAt = new Date($('#deal-ends-date').val());
            $('#time-left').countdown({
                until: endsAt,
                compact: false,
                layout: $('#time-left').html()
            });

            $('.deals-timeleft').fadeIn();
            $('#deal-countries').ddslick({
                width: 223,
                selectText: 'SELECT YOUR COUNTRY',
            });
        });
    </script>

{% endblock %}
