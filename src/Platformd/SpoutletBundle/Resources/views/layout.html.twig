<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

		<script type="text/javascript">
			var CKEDITOR_BASEPATH = '/ckeditor/';
		</script>

        {% block open_graph %}

        {% endblock %}

        {% block stylesheets %}
		    {% stylesheets
                'plugins/jquery.ad-gallery/jquery.ad-gallery.css'
		        'bundles/spoutlet/css/style.css'
		        'bundles/spoutlet/css/superfish-aw.css'
		        'bundles/spoutlet/css/thickbox.css'
		        'bundles/spoutlet/css/custom-theme/jquery-ui-1.8.16.custom.css'
		        'bundles/spoutlet/css/account-registration.css'
		        'bundles/spoutlet/css/account.css'
		        'bundles/spoutlet/css/default.css'
		        'bundles/spoutlet/css/legal.css'
		        'bundles/spoutlet/css/new.css'
		        'bundles/comment/css/comments.css'
		        'ckeditor/skins/kama/editor.css'
		        filter='cssrewrite'
		        output='css/packed/layout.css'
		    %}
		    <link type="text/css" rel="stylesheet" href="{{ asset_url }}" />
		    {% endstylesheets %}
        {% endblock %}


        {% block javascripts %}
		    {% javascripts
		        'bundles/spoutlet/js/jquery-1.7.2.min.js'
		        'bundles/spoutlet/js/jquery-ui-1.8.16.custom.min.js'
		        'bundles/spoutlet/js/jquery.ajaxfileupload.js'
		        'bundles/spoutlet/js/jquery.cycle.all.js'
		        'bundles/spoutlet/js/jquery.dropshadow.js'
		        'bundles/spoutlet/js/jquery.qtip.min.js'
		        'bundles/spoutlet/js/jquery.simplemodal.js'
		        'bundles/spoutlet/js/jquery.simpletip.js'
		        'bundles/spoutlet/js/jquery.truncate.min.js'
		        'bundles/spoutlet/js/progressbar.js'
		        'bundles/spoutlet/js/superfish.js'
		        'bundles/spoutlet/js/supersubs.js'
		        'bundles/spoutlet/js/custom.js'
		        'bundles/spoutlet/js/google-dfp.js'
                'bundles/spoutlet/js/jquery.countdown.min.js'
                'bundles/spoutlet/js/jquery.ddslick.min.js'
		        'bundles/spoutlet/alt_js/*'
		        'bundles/comment/js/comments.js'
		        'ckeditor/ckeditor.js'
		        'ckeditor/config.js'
		        'ckeditor/lang/en.js'
                'plugins/jquery.ad-gallery/jquery.ad-gallery.js'
		        output='js/packed/layout.js'
		    %}
		    <script type="text/javascript" src="{{ asset_url }}"></script>
		    {% endjavascripts %}
        {% endblock %}

        <title>
            {%- if block('title') -%}
                {{ block('title') }} | {{ 'platformd.layout.title_suffix' | trans }}
            {%- else -%}
            {{ 'platformd.layout.default_title' | trans }}
            {%- endif -%}
        </title>

		<script type="text/javascript">

		    $(document).ready(function(){
		        $("ul.sf-menu").supersubs({
		            minWidth:   12,   // minimum width of sub-menus in em units
		            maxWidth:   27,   // maximum width of sub-menus in em units
		            extraWidth: 1     // extra width can ensure lines don't sometimes turn over
		                              // due to slight rounding differences and font-family
		        }).superfish({
					delay:		150
				});           // call supersubs first, then superfish, so that subs are
		                              // not display:none when measuring. Call before initialising
		                              // containing tabs for same reason.

                $("ul.sf-menu-account").supersubs({
                    minWidth:   12,   // minimum width of sub-menus in em units
                    maxWidth:   27,   // maximum width of sub-menus in em units
                    extraWidth: 1     // extra width can ensure lines don't sometimes turn over
                                      // due to slight rounding differences and font-family
                }).superfish({
                    delay:      150
                });           // call supersubs first, then superfish, so that subs are
                                      // not display:none when measuring. Call before initialising
                                      // containing tabs for same reason.

		    });
		</script>
		<script type="text/javascript">

			$(document).ready(function(){
				$('#toggleRegion').click(function(e){
                    e.preventDefault();

				    $('#selectRegion').toggle();
				    $('#selectLanguage').hide();
				});

				$('#toggleLanguage').click(function(e){
                    e.preventDefault();

				    $('#selectLanguage').toggle();
				    $('#selectRegion').hide();
				});
			});
		</script>
        {% include 'SpoutletBundle:Default:_prep_google_dfp.html.twig' %}
        {% include 'SpoutletBundle::_analytics.html.twig' %}
	</head>
	<body class="site-{{ app.session.locale }}">
        {% if facebook_app_id %}
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId={{ facebook_app_id }}";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>
        {% endif %}

		<div id="omni">
            {# big line to add a background-image if the page_background_image block has been set #}
	        <div id="page"{{ (block('page_background_image') ? (' style="background-image: url(\'%url%\');"'|replace({'%url%': block('page_background_image')})) : '') | raw }}>
	            <div class="background-takeover" id="custom_background_top">
	                <div class="background-takeover" id="custom_background_bot">
	                    <div id="header">
	                    	{% include 'SpoutletBundle::header.html.twig' %}
	                    </div>
	                    <div id="mainNav-wrapper">
	                        {% include 'SpoutletBundle::navigation.html.twig' %}
	                    </div>
	                    <div id="content">
                            {% block pre_content_nav %}{% endblock %}

                            {#
                                Messy, but taken from the old site
                                To show a flash message, set the "flash" block
                                to your actual message. Then set the "flash_type"
                                block to: success, warning, or error

                                This also works out of the box for "error"
                                and "success"session flashes - given an "error"
                                type and the message is dumped out with
                                some markup

                                Also, yes, I know this is hideous...
                            #}

                            {% if app.session.hasFlash('error') %}
                                {% set sessionFlashType = 'error' %}
                            {% elseif (app.session.hasFlash('success')) %}
                                {% set sessionFlashType = 'success' %}
                            {% else %}
                                {% set sessionFlashType = block('flash_type') %}
                            {% endif %}

                            {% if  sessionFlashType %}
                                <div class="xnotices">
                                    <div class="{{ sessionFlashType }}Notice notice">
                                        <div class="pad">
                                            <div class="pad2">
                                                <div class="pad3">
                                                    <div class="pad4">
                                                        {#
                                                            funny, I had to set this as a variable - concatenating
                                                            and translating the string all in one line was a fail
                                                        #}
                                                        {% set flashTitleKey = 'platformd.flash.'~sessionFlashType~'_title' %}
                                                        <h3>
                                                            {{ flashTitleKey | trans }}
                                                        </h3>

                                                        {% if app.session.getFlash(sessionFlashType) %}
                                                            <p>
                                                                {{ app.session.getFlash(sessionFlashType) | trans }}
                                                            </p>
                                                        {% else %}
                                                            {{ block('flash') }}
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}

	                    	{% block content %}{% endblock %}
	                    </div>
	                    {% include 'SpoutletBundle:Default:_dealsAdBottom.html.twig' %}
                        {% if block('legal_footer') %}
                            <div class="legalese">
                                {{ block('legal_footer') }}
                            </div>
                        {% endif %}
	                    {% include 'SpoutletBundle::footer.html.twig' %}
	                </div>
	            </div>
	        </div>
	    </div>
	</body>
</html>
